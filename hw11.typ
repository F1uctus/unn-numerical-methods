#import "@preview/cetz:0.3.4"
#import "@preview/cetz-plot:0.1.1": plot, chart
#import "@preview/physica:0.9.5": *
#import "@preview/showybox:2.0.4": showybox
#import "@preview/fletcher:0.5.7": diagram, node, edge


#let SURNAME_NAME = "Никитин Илья"
#let UNN_GROUP = "3822Б1МА1"
#let n = 21


#set page(
  paper: "a4",
  margin: (top: 3em, rest: 0.8cm),
  numbering: "1 / 1",
  header: [
    ДЗ.11. Исследование аппроксимации и устойчивости разностных схем для ЗК.
    #h(1fr)
    #eval(mode: "math", "n = " + repr(n) + ",")
    #h(1fr)
    #SURNAME_NAME, #UNN_GROUP
  ],
)
#show heading: it => grid(
  columns: (1fr, auto, 1fr),
  align: horizon + center,
  column-gutter: 5pt,
  line(length: 100%), it.body, line(length: 100%),
)
#set par(justify: true, first-line-indent: 2em)

#let hl(eqtn) = rect(
  stroke: gray,
  inset: (top: 10pt, bottom: 10pt, left: 5pt, right: 5pt),
  $display(eqtn.body)$,
)

//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
=== Задача 5
Определить порядок аппроксимации схемы, приближающей
уравнение $y' = f$, и исследовать её на устойчивость.

$
  (y_n + 4 y_(n - 1) - 5 y_(n - 2)) slash 6 h
  = (2 f_(n - 1) + f_(n - 2)) slash 3.
$

*Решение.*
Разложим в ряд Тейлора слагаемые разностной схемы вокруг точки $x_n$:
$
  (y_n + 4 y_(n - 1) - 5 y_(n - 2)) / (6 h)
  &=
  1 / (6 h) (
      y_n
    + 4 (y_n - h y'_n + h^2 / 2 y''_n - h^3 / 6 y'''_n)
    - 5 (y_n - 2 h y'_n + 2 h^2 y''_n - (4 h^3) / 3 y'''_n)
  )
  = \ &=
  1 / (6 h) (
      y_n
    + 4 y_n - 4 h y'_n + 2 h^2 y''_n - (2 h^3) / 3 y'''_n
    - 5 y_n + 10 h y'_n - 10 h^2 y''_n + (20 h^3) / 3 y'''_n
  )
  = \ &=
  (6 h y'_n - 8 h^2 y''_n + 6 h^3 y'''_n) / (6 h)
  =
  #hl($y'_n - (4 h) / 3 y''_n + h^2 y'''_n + O(h^3),$)
$
$
  (2 f_(n - 1) + f_(n - 2)) / 3
  &=
  1 / 3 (
      2(y'_n - h y''_n + h^2 / 2 y'''_n)
    + (y'_n - 2 h y''_n + 2 h^2 y'''_n)
  )
  = \ &=
  1 / 3 (
    2 y'_n - 2 h y''_n + h^2 y'''_n
  + y'_n - 2 h y''_n + 2 h^2 y'''_n
  )
  =
  (3 y'_n - 4 h y''_n + 3 h^2 y'''_n) / 3
  =
  #hl($y'_n - (4 h) / 3 y''_n + h^2 y'''_n + O(h^3).$)
$

Разность между частями имеет порядок $O(h^3)$,
следовательно, схема имеет третий порядок аппроксимации.
\
Для однородного уравнения $y' = 0$ разностная схема принимает вид:
$y_n + 4 y_(n - 1) - 5 y_(n - 2) = 0.$
\
Характеристическое уравнение:
$r^2 + 4 r - 5 = 0.$
Корни: $r_1 = 1$, $r_2 = -5$.
Так как $|r_2| = 5 > 1$, схема неустойчива.

#enum(
  numbering: it => [*Ответ:*],
  [
    разностная схема неустойчива, имеет третий порядок аппроксимации.
  ],
)


//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
=== Задача 6
Проверить, аппроксимирует ли разностная схема
уравнение $y' = f(x, y)$:
$
  (y_k - 3 y_(k - 2) + 2 y_(k - 3)) slash 8h
  = (f_(k - 1) + f_(k - 2)) slash 2.
$

*Решение.*
Разложим $y_(k-m)$ в ряд вокруг $x_k$ до $O(h^4)$:

$
  y(x_k - m h)
  = y_k
  - m h y'_k
  + (m h)^2 / 2 y''_k
  - (m h)^3 / 6 y'''_k
  + O(h^4).
$

Подставим для $m=2$ и $m=3$:
$
  y_(k - 2)
  &= y_k -2h y'_k
  + 2h^2 y''_k
  - (4 h^3) slash 3 y'''_k
  + O(h^4),
  quad
  y_(k - 3)
  &= y_k -3h y'_k
  + (9 h^2) slash 2 y''_k
  - (9 h^3) slash 2 y'''_k
  + O(h^4).
$

Вычислим левую и правую части:
$
  1 / (8h) ( y_k
    - 3 y_(k - 2)
    + 2 y_(k - 3) )
  = 1 / (8h) ( 3h^2 y''_k - 5h^3 y'''_k + O(h^4) )
  = (3 h^2) / (8 h) y''_k + O(h^3)
  &~ #hl($(3 h) / 8 y''_k + O(h^2).$)
  \
  1 / 2 (f_(k - 1) + f_(k - 2))
  = 1 / 2 (y'_k - h y''_k  + y'_k - 2h y''_k + O(h^2))
  &= #hl($y'_k - (3 h) / 2 y''_k + O(h^2).$)
$

Для консистентности нужно, чтобы при замене $y_k$ из точного решения
при $h -> 0$ левая и правая части совпадали в ведущем порядке.
Но правая часть имеет ненулевой $y'_k$ при $h -> 0$,
а левая — стремится к нулю как $O(h)$.
Это означает, что схема *не является консистентной*, и,
следовательно, *не аппроксимирует* уравнение.

#enum(
  numbering: it => [*Ответ:*],
  [разностная схема не аппроксимирует уравнение.],
)

//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
=== Задача 7

Повысить порядок аппроксимации схемы задачи 3:
$
  (y_(n + 1) + y_n - 2 y_(n - 1)) / (3 h)
  = (5 f_n + f_(n - 1)) / 6.
$

*Решение.*
Разложим левую часть в ряд Тейлора:
$
  (y_(n + 1) + y_n - 2 y_(n - 1)) / (3 h)
  &= display(
  y_n + h y'_n + h^2 / 2 y''_n + h^3 / 6 y'''_n + O(h^4)
  + y_n - 2(y_n - h y'_n + h^2 / 2 y''_n - h^3 / 6 y'''_n + O(h^4))
  ) / (3 h)
  \ &=
  #hl($y'_n - h / 6 y''_n + h^2 / 6 y'''_n + O(h^3).$)
$

Добавим дополнительную точку $f_(n + 1)$ и перепишем разностную схему:
$quad display((A f_(n + 1) + B f_n + C f_(n - 1)) / D).$

$
  f_(n + 1) = y'_n + h y''_n + h^2 / 2 y'''_n + ...
  quad --> quad
  display(
    A (y'_n + h y''_n + h^2 / 2 y'''_n)
    + B y'_n
    + C (y'_n - h y''_n + h^2 / 2 y'''_n)
  ) / D.
$

Сгруппируем и выразим коэффициенты:
$
  display( (A + B + C) y'_n
  + (A - C) h y''_n
  + (A + C) h^2 / 2 y'''_n
  ) / D + ...
  thick, \
  cases(
    display((A + B + C) / D = 1)\,,
    display((A + C) / D = -1 / 6)\,,
    display((A + C) / (2D) = 1 / 6).
  )
  quad ~> quad
  cases(
    gap: #1em,
    display((-A + C) / D = -1 / 6)\,,
    display((A + C) / (2D) = 1 / 6).
  )
  quad ~> quad
  cases(
    gap: #1em,
    display(-A + C = -D/6)\,,
    display(A + C = D/3).
  )
$

$
  cases(
    gap: #1em,
    display(
      (A - C) + (A + C)
      = 2A
      = -D / 6 + D / 3
      = D / 6
      quad &==> quad
      A = D / 12,
    )\,, display(
      (A - C) - (A + C)
      = -2C
      = -D / 6 - D / 3
      = -D / 2
      quad &==> quad
      C = D / 4
    )\,, display(
      A + B + C
      = D / 12 + B + D / 4
      = B + D / 3
      = D
      quad &==> quad
      B = (2D) / 3,
    ).
  )
$

$
  "Пусть" D = 12
  quad ==> quad
  (f_(n + 1) + 8 f_n + 3 f_(n - 1)) / 12.
$

Подставим разложения для $f_(n+1)$ и $f_(n-1)$ в правую часть:
$
  f_(n + 1)
  = y'_n + h y''_n + h^2 / 2 y'''_n &+ h^3 / 6 y''''_n + ...
  thick, quad
  f_(n - 1)
  = y'_n - h y''_n + h^2 / 2 y'''_n - h^3 / 6 y''''_n + ...
  quad ==> \ ==> quad
  f_(n + 1) + 8 f_n + 3 f_(n - 1)
  &= y'_n + h y''_n + h^2 / 2 y'''_n
  + 8 y'_n
  + 3 y'_n
  - 3 h y''_n
  + (3 h^2) / 2 y'''_n
  = \ &=
  (1 + 8 + 3) y'_n
  + (h - 3 h) y''_n
  + (h^2 / 2 + (3 h^2) / 2) y'''_n
  = \ &=
  12 y'_n - 2 h y''_n + 2 h^2 y'''_n
  quad ==> \ ==> quad
  (12 y'_n - 2 h y''_n + 2 h^2 y'''_n) / 12
  &=
  #hl($y'_n - h / 6 y''_n + h^2 / 6 y'''_n + O(h^3).$)
$

Теперь левая и правая части совпадают с точностью до $O(h^3)$.

#enum(
  numbering: it => [*Ответ:*],
  [
    получена разностная схема третьего порядка аппроксимации:
    $
      (y_(n + 1) + y_n - 2 y_(n - 1)) / (3 h)
      = (f_(n + 1) + 8 f_n + 3 f_(n - 1)) / 12.
    $
  ],
)
